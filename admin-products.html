<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - All Products</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Arial',sans-serif;}
body{background:#f4f4f9;}
.sidebar{width:220px;height:100vh;background:#222;color:white;padding-top:25px;position:fixed;top:0;left:0;}
.sidebar h2{text-align:center;margin-bottom:20px;font-size:24px;color:#ff4500;}
.sidebar a{display:flex;align-items:center;padding:12px 20px;color:white;text-decoration:none;font-size:16px;transition:0.3s;}
.sidebar a i{margin-right:10px;}
.sidebar a:hover, .sidebar a.active{background:#ff4500;border-radius:6px;}
.content{margin-left:240px;padding:30px;min-height:100vh;}
.content h1{text-align:center;margin-bottom:15px;color:#222;}
.clear-btn{background:#dc3545;color:white;border:none;padding:20px 18px;border-radius:6px;margin-bottom:20px;cursor:pointer;transition:0.3s;font-size:20px;}
.clear-btn:hover{background:#ff5a5a;}
.btn{background:green;color:white;border:none;padding:20px 18px;border-radius:6px;margin-bottom:20px;margin-left:20px;cursor:pointer;transition:0.3s;font-size:20px;}
.btn:hover{background:#ff5a5a;}
/* Dashboard Cards */
.dashboard-box{display:flex;flex-wrap:wrap;gap:25px;justify-content:center;margin-bottom:25px;}
.box{background:white;padding:25px;border-radius:12px;flex:1 1 220px;text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.1);font-size:18px;font-weight:bold;transition:0.3s;}
.box:hover{transform:translateY(-5px);box-shadow:0 12px 30px rgba(0,0,0,0.2);}
.box i{font-size:28px;color:#ff4500;margin-bottom:10px;display:block;}

/* Product Grid */
.product-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;}
.product-item{background:white;padding:15px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.1);transition:0.3s;}
.product-item:hover{transform:translateY(-5px);box-shadow:0 12px 25px rgba(0,0,0,0.2);}
.product-item img{width:100%;height:180px;object-fit:cover;border-radius:8px;margin-bottom:10px;}
.product-item h3{margin:10px 0 5px;color:#222;}
.product-item p{margin:4px 0;color:#555;font-size:14px;}
.product-item .sizes span{margin-right:6px;padding:3px 6px;border-radius:4px;font-size:13px;}
.product-item .sizes .low{background:#ffcccc;color:#a00;}
.product-item .sizes .normal{background:#ccffcc;color:#060;}
.product-item button{border:none;padding:8px 12px;border-radius:6px;margin-top:10px;margin-right:5px;cursor:pointer;font-size:14px;transition:0.3s;}
.product-item .edit-btn{background:#ff4500;color:white;}
.product-item .edit-btn:hover{background:#ff6b35;}
.product-item .delete-btn{background:#dc3545;color:white;}
.product-item .delete-btn:hover{background:#ff5a5a;}

/* Stock Highlights */
.low-stock { border: 2px solid #ffcc00; }
.out-of-stock { border: 2px solid #dc3545; opacity: 0.6; }

/* Modal */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:100;}
.modal-content{background:white;padding:25px;border-radius:12px;width:350px;position:relative;}
.modal-content input, .modal-content textarea, .modal-content select, .modal-content button{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;font-size:14px;transition:0.3s;}
.modal-content input:focus, .modal-content textarea:focus, .modal-content select:focus{border-color:#ff4500;outline:none;box-shadow:0 0 8px rgba(255,69,0,0.3);}
.modal-content button{background:#ff4500;color:white;border:none;cursor:pointer;font-size:15px;}
.modal-content button:hover{background:#ff6b35;}
.close-btn{position:absolute;top:10px;right:12px;cursor:pointer;font-weight:bold;font-size:20px;color:#555;}
</style>
</head>
<body>

<div class="sidebar">
<h2><i class="fas fa-shoe-prints"></i> Admin</h2>
<a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
<a href="admin.html"><i class="fas fa-plus"></i> Add Product</a>
<a class="active" href="admin-products.html"><i class="fas fa-boxes"></i> All Products</a>
<a href="admin-orders.html"><i class="fas fa-shopping-cart"></i> Orders</a>
<a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
</div>

<div class="content">
<h1>All Products</h1>
<button class="clear-btn" onclick="clearAllProducts()">Clear All Products</button>
<button class="btn" href="#menProducts">Men & Boys</button>
<button class="btn" href="#ladiesProducts">Ladies</button>

<div class="dashboard-box">
<div class="box"><i class="fas fa-box"></i>Total Products: <span id="totalProducts">0</span></div>
<div class="box"><i class="fas fa-exclamation-triangle"></i>Low Stock: <span id="lowStock">0</span></div>
<div class="box"><i class="fas fa-coins"></i>Total Inventory: ₹<span id="inventoryValue">0</span></div>
</div>

<h2>Men & Boys</h2>
<div id="menProducts" class="product-list"></div>

<h2>Ladies</h2>
<div id="ladiesProducts" class="product-list"></div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editModal">
<div class="modal-content">
<span class="close-btn" onclick="closeModal()">×</span>
<h3>Edit Product</h3>
<input type="text" id="editName" placeholder="Product Name" required>
<input type="file" id="editImage" accept="image/*">
<textarea id="editSizes" placeholder="size:qty, size:qty"></textarea>
<input type="number" id="editPrice" placeholder="Price" required>
<select id="editCategory" required>
<option value="">Select Category</option>
<option value="men">Men & Boys</option>
<option value="ladies">Ladies</option>
</select>
<button onclick="saveEdit()">Save Changes</button>
</div>
</div>

<script>
if(localStorage.getItem("adminLoggedIn")!=="true") window.location.href="login.html";
function logout(){localStorage.removeItem("adminLoggedIn"); window.location.href="login.html";}

// Get products from localStorage
let products = JSON.parse(localStorage.getItem("adminProducts")) || [];
let editIndex = null;

const menProducts = document.getElementById("menProducts");
const ladiesProducts = document.getElementById("ladiesProducts");

// Clear all products function
function clearAllProducts(){
    if(confirm("Are you sure you want to delete ALL products?")){
        localStorage.removeItem("adminProducts");
        products = [];
        loadProducts();
    }
}

// Update dashboard stats
function updateDashboard(){
    let total=products.length, low=0, totalValue=0;
    products.forEach(p=>{
        let sumQty=0;
        p.sizes.forEach(s=>{sumQty+=s.qty; if(s.qty<=2) low++;});
        totalValue += sumQty*p.price;
    });
    document.getElementById("totalProducts").innerText=total;
    document.getElementById("lowStock").innerText=low;
    document.getElementById("inventoryValue").innerText=totalValue;
}

// Load products to page
function loadProducts(){
    menProducts.innerHTML=""; ladiesProducts.innerHTML="";
    const menItems=products.filter(p=>p.category==="men");
    const ladiesItems=products.filter(p=>p.category==="ladies");
    if(menItems.length===0) menProducts.innerHTML="<p>No products in this category.</p>";
    if(ladiesItems.length===0) ladiesProducts.innerHTML="<p>No products in this category.</p>";
    menItems.forEach((p,index)=>{menProducts.innerHTML+=productCardHTML(p,index,'men');});
    ladiesItems.forEach((p,index)=>{ladiesProducts.innerHTML+=productCardHTML(p,index,'ladies');});
    updateDashboard();
}

// Product card HTML
function productCardHTML(p,index,category){
    const totalQty = p.sizes.reduce((sum,s)=>sum+s.qty,0);
    let stockClass = "";
    if(totalQty === 0) stockClass = "out-of-stock";
    else if(totalQty <= 2) stockClass = "low-stock";

    return `<div class="product-item ${stockClass}">
        <img src="${p.image}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p>Price: ₹${p.price}</p>
        <p>Total Quantity: <strong>${totalQty}</strong></p>
        <p class="sizes">Sizes: ${p.sizes.map(s=>`<span class="${s.qty<=2?'low':'normal'}">${s.size} (${s.qty})</span>`).join("")}</p>
        <button class="edit-btn" onclick="openEditModal(${index},'${category}')" ${totalQty===0?'disabled style="opacity:0.5;cursor:not-allowed;"':''}>Edit</button>
        <button class="delete-btn" onclick="deleteProduct(${index},'${category}')" ${totalQty===0?'disabled style="opacity:0.5;cursor:not-allowed;"':''}>Delete</button>
    </div>`;
}

// Delete single product
function deleteProduct(index,category){
    let catProducts=products.filter(p=>p.category===category);
    const actualIndex=products.indexOf(catProducts[index]);
    if(confirm("Delete this product?")){
        products.splice(actualIndex,1); 
        localStorage.setItem("adminProducts",JSON.stringify(products));
        loadProducts();
    }
}

// Edit product modal
function openEditModal(index,category){
    let catProducts=products.filter(p=>p.category===category);
    const product=catProducts[index];
    editIndex=products.indexOf(product);
    document.getElementById("editName").value=product.name;
    document.getElementById("editSizes").value=product.sizes.map(s=>`${s.size}:${s.qty}`).join(", ");
    document.getElementById("editPrice").value=product.price;
    document.getElementById("editCategory").value=product.category;
    document.getElementById("editModal").style.display="flex";
}

function closeModal(){document.getElementById("editModal").style.display="none"; editIndex=null;}

function saveEdit(){
    if(editIndex===null) return;
    const name=document.getElementById("editName").value.trim();
    const price=parseFloat(document.getElementById("editPrice").value);
    const category=document.getElementById("editCategory").value;
    let sizesInput=document.getElementById("editSizes").value.replace(/\s+/g,"").split(",");
    let sizeMap={}; sizesInput.forEach(s=>{const [sz,qt]=s.split(":");sizeMap[sz]=Number(qt);});
    const sizes=Object.keys(sizeMap).map(k=>({size:k,qty:sizeMap[k]}));
    if(!name || isNaN(price) || !category || sizes.length===0){alert("Please fill all fields correctly."); return;}
    const imageInput=document.getElementById("editImage");
    if(imageInput.files.length>0){
        const reader=new FileReader();
        reader.onload=function(){
            products[editIndex]={...products[editIndex],name,image:reader.result,sizes,price,category};
            localStorage.setItem("adminProducts",JSON.stringify(products)); loadProducts(); closeModal();
        }
        reader.readAsDataURL(imageInput.files[0]);
    } else{
        products[editIndex]={...products[editIndex],name,sizes,price,category};
        localStorage.setItem("adminProducts",JSON.stringify(products)); loadProducts(); closeModal();
    }
}

loadProducts();
</script>
</body>
</html>
